---
title: "Implementing automated section control sprayers for optimising pesticide application in orchards"
author: "Clemens Stephany, Christoph Weinmann, Lucas Hoffmann, Adrian FÃ¼lle, Jasper Hackling"
date: "6/1/2021"
output: html_document
---

\ 

#### Description   
Reducing pesticide use: An analysis on the decision whether to implement an automated or manually operated section control sprayer in orchards.

\ 

#### Decision maker: farmer   
* Farmer is the main stakeholder who makes the decision whether or not to buy a modern sprayer which is able to minimise pesticide application rates

\ 

#### Stake holders: (describe further)
* Farmers 
* Manufacturers 
* Government 
* Consumers 
* Society 
* Food retailers 
* Water suppliers 
* Agrochemical companies 
* NGOs 
* Local biodiversity
* Beekeepers

\ 

#### Problems:    
* Some common agrochemicals will be banned in the near future for various reasons
  + Overuse causes problems 
  + Public opinion is getting worse   
* Excessive use of pesticides can cause unwanted effects (e.g. resistances)  
* Agrochemicals are costly supplies $\Rightarrow$ reduction is welcome  

\ 

#### Options:  
* No change 
* Spray less pesticide with existing machinery 
* Adopt organic farming practices 
* Use beneficiaries (beneficial organisms)
* Spray manually 
* Buy automatic section control sprayer
* Buy manual section control sprayer

\ 

#### Allocation of resources:  
* Money
  + Overheads
  + Running costs 
* Labour 
  + Conducting actual tasks 
  + Acquiring know-how
* Pollinators  

\ 

#### Obstacles:  
* Costs of investment
* Learning curve for running the equipment 
* compatibility with current machinery

#### Uncertainties:  
* Potential reduction of pesticides using an automatic section controlled sprayer
  + Especially the reduction of excessive pesticides
* Common application rates of pesticides in orchards
* Potential Cost of an automatic section controlled sprayer
* Changing climate influencing the frequency of pesticides application
* Increased bee survival rate (as there still are pesticides, just less)
* Added value through increased bee survival and thus increasing pollination
* Governmental interest in pesticides reduction
* Image of a farmer trying to reduce pesticides but still using them
* Maintenance cost of an more complicated and sensitive system

#### (Sources of) information:
* Farmers
  + 
* Manufacturer (Currently developing a prototype)
  + Cost and capabilities of an automatic section control sprayer
* Landwirtschaftskammer NRW
  + Potential subsidisation of automatic section control sprayer
  + Political foreshadowing of future legislations
* (commercial) Beekeepers
  + How much of an problem are pesticides
* Consumers
  + Assess the importance/conception of reduced pesticide application to the consumer 


#### Flow chart using diagrammeR package 
```{r, include=FALSE}
library(DiagrammeR)
library(DiagrammeRsvg)
library(rsvg)
```


```{r, echo=FALSE}

model_flow_chart <- grViz("
      
digraph boxes_and_circles {

 # Change flow chart orientation (top down: 'TD'; left to right: 'LR' 
 rankdir = 'TD'

 # Add node statements
 node [shape = box
       fontname = Arial
       fontsize = 20 
       color = gray50
       penwidth = 1 
       fixedsize = true 
       width = 3
       height = 0.7]
       
 # Add edge statements (arrows)
 edge [fontsize = 25
       fontname = Arial
       penwidth = 1.5]
       
 # Add graph statements 
 graph [nodesep = 0.1]
        
 
 # Create nodes 
       
 FP [label = 'Farmers profit']
 Pe [label = 'Pesticides']
 Di [label = 'Diseases']
 GC [label = 'Government \n concerns']
 FS [label = 'Fruit sales']
 Bio [label = 'Biodiversity']
 Ascs [label = 'Automated section \n control sprayer']
 WC [label = 'Water \n contamination']
 Cu [label = '  Customers']
 
 
 # Interconnections 

 GC->FP [label = '  -',
         fontcolor = 'red',
         color = 'red']
         
 FS->FP [label = '  +',
        fontcolor = 'forestgreen',
        color = 'forestgreen']
 
 Pe->WC [label = '  +',
         fontcolor = 'forestgreen',
         color = 'forestgreen']
 
 WC->GC [label = '+',
         fontcolor = 'forestgreen',
         color = 'forestgreen']
 
 Ascs->Pe [label = '  -',
           fontcolor = 'red',
           color = 'red']
         
 Bio->FS [label = '  +',
         fontcolor = 'forestgreen',
         color = 'forestgreen']
 
 Pe->Bio [label = '  -',
          fontcolor = 'red',
          color = 'red']
         
 WC->Bio [label = '  -',
          fontcolor = 'red',
          color = 'red']
          
 Pe->Cu [label = '  -',
         fontcolor = 'red',
         color = 'red']
         
 Pe->Di [label = '  -',
         fontcolor = 'red',
         color = 'red']
         
 Bio->Di [label = '  -',
         fontcolor = 'red',
         color = 'red']
         
 Di->FS [label = '  -',
         fontcolor = 'red',
         color = 'red']
        
 Cu->FS [label = '+',
         fontcolor = 'forestgreen',
         color = 'forestgreen']
        
 Pe->FP [label = '  -',
         fontcolor = 'red',
         color = 'red']
         
 FP->Ascs [label = '  +',
           fontcolor = 'forestgreen',
           color = 'forestgreen']
}
")

# Plot flow chart 
model_flow_chart

# Export flow chart as .png files; save in "images" folder 
rsvg_png(charToRaw(export_svg(model_flow_chart)), "images/flow-chart.png") 



```

<!-- Not finished yet
#### Calculating the decision model {.tabset}
##### Input
```{r echo = FALSE}
# Input table for model function, adding Management_cost

input_estimates <- data.frame(variable = c("Farmers Profit", "Automated section control", "Pesticides", "Water contamination", " Customers", "Goverment concerens", "Biodiversity", "Diseases", "Fruit sales"),
                              lower = c(6000, 3, 500, 100),
                              median = NA,
                              upper = c(14000, 8, 1000, 2000),
                              distribution = c("posnorm", "posnorm", "posnorm", "posnorm"),
                              label = c("Yield (kg/ha)", "Price (USD/kg)", "Labor cost (USD/ha)", "Management cost (USD/ha)"),
                              Description = c("Yield in a sweet cherry farm under normal conditions",
                                              "Price of sweet cherry in a normal season",
                                              "Labor costs in a normal season", 
                                              "Management costs in a normal season"))

## Changing some columns as they are not in the right format (addition, maybe because R-base 3.6.3?)
input_estimates$distribution <- as.character(input_estimates$distribution)
input_estimates$variable <- as.character(input_estimates$variable)

# Show input_estimates table
input_estimates
```

##### Model
```{r}
# Creating model function to describe the graphical impact pathway (Diagram done earlier)
model_function <- function(){
  
  # Estimate the income in a normal season
  income <- Yield * Market_price
  
  # Estimate the overall cost in a normal season
  overall_cost <- Labor_cost + Management_cost
  
  # Estimate the final results from the model
  final_result <- income - overall_cost
  
  # Generate the list of outputs from the Monte Carlo simulation
  return(list(final_result = final_result))
}

# Run the Monte Carlo simulation using the model function
mc_simulation <- mcSimulation(estimate = as.estimate(input_estimates),
                                    model_function = model_function,
                                    numberOfModelRuns = 1000000,
                                    functionSyntax = "plainNames")

# Print MonteCarlo simulation output
# mc_simulation

# Function for creating a random variable for a column from the input_estimates table 
# and put it in the global Env. for test purposes (faster that running whole model)
make_variables <- function(est,n=1)
{ x<-random(rho=est, n=n)
for(i in colnames(x)) assign(i,
                             as.numeric(x[1,i]),envir=.GlobalEnv)
}

# Creating random global variable from input_estimates
make_variables(as.estimate(input_estimates))

# Call function (without parameters as they are in the global environment)
model_function()
```

##### Graph {.active}
```{r, echo=FALSE}

# Plot distributions to show outcome
plot_distributions(mcSimulation_object = mc_simulation,
                   vars = "final_result",
                   method = "hist_simple_overlay",
                   old_names = "final_result",
                   new_names = "Outcome distribution for profits")

```
-->
 